{% extends 'base.html' %}

{% block content %}
<div class="container mt-5 pt-4">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="hero-title">ðŸ“… GestiÃ³n de Disponibilidad</h1>
            <p class="text-muted">Visualiza los horarios y haz click para reservar un servicio de tarot.</p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="card-minimal p-4">
                <div id="calendar"></div>
            </div>
        </div>
    </div>
</div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
// ----------------------------
// FUNCIONES DE SIMULACIÃ“N
// ----------------------------
function generarHorariosFalsos() {
    const eventosFalsos = [];
    const hoy = new Date();
    const dia = hoy.toISOString().split('T')[0]; // "YYYY-MM-DD"
    
    let hora = 9;
    while (hora < 17) {
        const startHour = Math.floor(hora).toString().padStart(2,'0');
        const startMinute = (hora % 1 === 0) ? '00' : '30';
        const endTime = hora + 0.5;
        const endHour = Math.floor(endTime).toString().padStart(2,'0');
        const endMinute = (endTime % 1 === 0) ? '00' : '30';

        const start = `${dia}T${startHour}:${startMinute}:00`;
        const end = `${dia}T${endHour}:${endMinute}:00`;

        eventosFalsos.push({
            id: `fake-${hora}`,
            title: 'Disponible',
            start: start,
            end: end,
            color: '#28a745',
            extendedProps: { is_reserved: false }
        });

        hora += 0.5;
    }

    return eventosFalsos;
}


// ----------------------------
// INICIALIZACIÃ“N DE FULLCALENDAR
// ----------------------------
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');

    // Horarios simulados
    var eventos = generarHorariosFalsos();

    // Servicios de tarot
    const servicios = [
        {nombre: "Tarot BÃ¡sico", duracion: 30, precio: 15000},
        {nombre: "Tarot Completo", duracion: 60, precio: 25000},
        {nombre: "Tarot del Amor", duracion: 45, precio: 20000},
        {nombre: "Tarot KÃ¡rmico", duracion: 90, precio: 30000},
    ];

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridWeek',
        locale: 'es',
        allDaySlot: false,
        slotDuration: '00:30:00',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'timeGridWeek,timeGridDay,listWeek'
        },
        events: eventos,
        selectable: false,

        eventClick: function(info) {
            if(!info.event.extendedProps.is_reserved) {
                info.event.setProp('title', 'Ocupado');
                info.event.setExtendedProp('is_reserved', true);
                info.event.setProp('color', '#dc3545');

                let mensaje = "Selecciona un servicio:\n";
                servicios.forEach(s => {
                    mensaje += `${s.nombre} - $${s.precio} - ${s.duracion} min\n`;
                });
                alert(mensaje);
            } else {
                alert('Este horario ya estÃ¡ ocupado.');
            }
        },

        eventDidMount: function(info) {
            if(info.event.extendedProps.is_reserved) {
                info.el.style.backgroundColor = '#dc3545';
                info.el.style.borderColor = '#dc3545';
            } else {
                info.el.style.backgroundColor = '#28a745';
                info.el.style.borderColor = '#28a745';
            }
        }
    });

    calendar.render();
});
</script>

<style>
.fc .fc-toolbar-title {
    color: var(--accent-gold);
    font-weight: 600;
}

.fc {
    background: var(--bg-card);
    border-radius: 12px;
    padding: 1rem;
}

.fc-event {
    border-radius: 8px;
    color: #fff;
    font-weight: 500;
    cursor: pointer;
    border: none !important;
    padding: 5px;
}

.card-minimal {
    background: var(--bg-card);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    backdrop-filter: blur(10px);
}
</style>
{% endblock %}

</style>
{% endblock %}
